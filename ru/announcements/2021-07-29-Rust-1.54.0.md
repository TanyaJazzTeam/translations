---
layout: post
title: Представляем Rust 1.54.0
author: The Rust Release Team
release: 'true'
---

Команда Rust рада сообщить о выпуске новой версии — Rust 1.54.0. Rust - это язык программирования, позволяющий каждому создавать надёжное и эффективное программное обеспечение.

Если у вас установлена предыдущая версия Rust через rustup, то обновиться на версию языка Rust 1.54.0 все так же просто, как никогда:

```console
rustup update stable
```

Если вы всё ещё не используете `rustup`, вы можете [получить] `rustup` на соответствующей странице нашего веб-сайта и ознакомиться с [подробными примечаниями к выпуску 1.54.0] на GitHub.

## Что стабилизировано в 1.54.0

### Атрибуты могут вызывать функциональные макросы

Rust 1.54 поддерживает вызов макросов подобных функциям внутри атрибутов. Функциональные макросы могут быть основаны на `macro_rules!` или процедурные макросы, которые вызываются как `macro!(...)`. Одним из примечательных вариантов использования этого является включение документации из других файлов в комментарии к документации Rust. Например, если README вашего проекта представляет собой хороший комментарий к документации, вы можете использовать `include_str!` для непосредственного включения содержимого. Раньше различные обходные пути допускали аналогичную функциональность, но с версии 1.54 это стало намного эргономичнее.

```rust=
#![doc = include_str!("README.md")]
```

Макросы также могут быть вложены в атрибут, например, для включения содержимого, созданного сценарием сборки:

```rust
#[path = concat!(env!("OUT_DIR"), "/generated.rs")]
mod generated;
```

Подробнее читайте [здесь](https://github.com/rust-lang/rust/pull/83366).

### Стабилизация компиляторных вставок (intrinsics) в wasm32

Стабилизирован ряд компиляторных вставок использующихся на платформе wasm32, что даёт доступ к инструкциям SIMD в WebAssembly.

Примечательно, что, в отличие от ранее стабилизированных `x86` и `x86_64`, у них нет требований безопасности, которые должны вызываться только при включении соответствующей целевой функции. Это связано с тем, что WebAssembly был написан с самого начала для безопасной проверки кода перед его выполнением, поэтому инструкции гарантированно декодируются правильно (или не декодируются вообще).

Это означает, что мы можем предоставить некоторые компиляторные вставки как полностью безопасные, например [`v128_bitselect`](https://doc.rust-lang.org/beta/core/arch/wasm32/fn.v128_bitselect.html). Однако есть некоторые компиляторные вставки, которые небезопасны, потому что они используют сырые указатели, например [`v128_load`](https://doc.rust-lang.org/beta/core/arch/wasm32/fn.v128_load.html).

### Инкрементальная компиляция снова включена по умолчанию

Инкрементальная компиляция была повторно включена по умолчанию в этом выпуске после того, как она была отключена по умолчанию в 1.52.1.

В Rust 1.52 была добавлена дополнительная проверка при загрузке данных инкрементной компиляции из кеша на диске. Это привело к обнаружению ряда ранее существовавших потенциальных проблем с надёжностью, поскольку проверка изменила эти скрытые ошибки на внутренние ошибки компилятора (ICE). В ответ команда компиляторов решила отключить инкрементную компиляцию в исправлении 1.52.1, что позволило пользователям избежать столкновения с ICE и лежащей в их основе несостоятельностью за счёт более длительного времени компиляции. [^1]

С тех пор мы провели [серию ретроспектив,] и участники усердно работали над устранением обнаруженных проблем, при этом некоторые исправления были внесены в 1.53, а большинство - в этом выпуске. [^2]

В настоящее время есть ещё две известные проблемы, которые могут привести к ICE. Из-за отсутствия автоматических отчётов о сбоях мы не можем быть уверены в полной степени воздействия нерешённых проблем. Однако на основании отзывов, полученных от пользователей, затронутых выпуском 1.52, мы считаем, что оставшиеся проблемы на практике возникают редко.

Поэтому в этом выпуске снова включена инкрементная компиляция!

[^1]: [примечания к выпуску 1.52.1] содержат более подробное описание этих событий. [^2]: Задача для отслеживания: [# 84970].

### Стабилизированные API

Стабилизированы следующие методы и реализации типажей.

- [`BTreeMap::into_keys`]
- [`BTreeMap::into_values`]
- [`HashMap::into_keys`]
- [`HashMap::into_values`]
- [`arch::wasm32`]
- [`VecDeque::binary_search`]
- [`VecDeque::binary_search_by`]
- [`VecDeque::binary_search_by_key`]
- [`VecDeque::partition_point`]

### Прочие изменения

В выпуске Rust 1.54.0 есть и другие изменения: узнайте, что изменилось в [Rust](https://github.com/rust-lang/rust/blob/master/RELEASES.md#version-1540-2021-07-29), [Cargo](https://github.com/rust-lang/cargo/blob/master/CHANGELOG.md#cargo-154-2021-07-29) и [Clippy](https://github.com/rust-lang/rust-clippy/blob/master/CHANGELOG.md#rust-154).

Также был исправлен rustfmt в версии 1.54.0 для правильного форматирования вложенных автономных модулей. Это может вызвать изменения в форматировании файлов, которые игнорировались 1.53.0 rustfmt. Подробности смотрите [здесь](https://github.com/rust-lang/rust/pull/86424).

### Участники сделавшие вклад в версию 1.54.0

Многие люди собрались вместе, чтобы создать Rust 1.54.0. Без вас мы бы не справились. [Спасибо!](https://thanks.rust-lang.org/rust/1.54.0/)


[получить]: https://www.rust-lang.org/install.html
[подробными примечаниями к выпуску 1.54.0]: https://github.com/rust-lang/rust/blob/master/RELEASES.md#version-1540-2021-07-29
[# 84970]: The [1.52.1 release notes] contain a more detailed description of these events.
[примечания к выпуску 1.52.1]: The tracking issue for the issues is [#84970].
[серию ретроспектив,]: https://github.com/rust-lang/rust/issues/84970
[`BTreeMap::into_keys`]: https://blog.rust-lang.org/2021/05/10/Rust-1.52.1.html
[`BTreeMap::into_values`]: https://github.com/rust-lang/compiler-team/issues/435
[`HashMap::into_keys`]: https://doc.rust-lang.org/std/collections/struct.BTreeMap.html#method.into_keys
[`HashMap::into_values`]: https://doc.rust-lang.org/std/collections/struct.BTreeMap.html#method.into_values
[`arch::wasm32`]: https://doc.rust-lang.org/std/collections/struct.HashMap.html#method.into_keys
[`VecDeque::binary_search`]: https://doc.rust-lang.org/std/collections/struct.HashMap.html#method.into_values
[`VecDeque::binary_search_by`]: https://doc.rust-lang.org/core/arch/wasm32/index.html
[`VecDeque::binary_search_by_key`]: https://doc.rust-lang.org/std/collections/struct.VecDeque.html#method.binary_search
[`VecDeque::partition_point`]: https://doc.rust-lang.org/std/collections/struct.VecDeque.html#method.binary_search_by