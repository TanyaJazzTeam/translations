---
layout: post
title: Планирование редакции Rust 2021
author: Ryan Levick
team: "The Rust 2021 Edition Working Group <https://www.rust-lang.org/governance/teams/lang#project-edition-2021>"
---

Рабочая группа Rust 2021 Edition рада сообщить, что следующая редакция Rust — Rust 2021 — запланирована на этот год. Пока что формально описывающий её [RFC](https://github.com/rust-lang/rfcs/pull/3085) остаётся открытым, но мы ожидаем, что в скором времени он будет принят. Планирование и подготовка уже начались, и мы идём по графику!

Если вам интересно, какие новшества появятся в Rust 2021 или когда эта редакция выйдет в стабильной версии, — читайте нашу статью!

## Что входит в эту редакцию?

Конечный список нововведений, которые войдут в Rust 2021, ещё не определён до конца. В целом мы планируем, что выпуск Rust 2021 будет намного меньше, чем Rust 2018, по следующим причинам:

- Ритм выпусков стал регулярным Это значит, что мы будем активно использовать плюсы "цепочечной" модели на уровне редакций Rust.
- Редакция Rust 2018 выбилась из модели "минимального стресса" выпусков.
- Сейчас просто нужно меньше фундаментальных изменений, чтобы язык продолжал развиваться.

Более подробно о развитии концепции редакций вы можете почитать в [RFC](https://github.com/rust-lang/rfcs/pull/3085).

Решение, войдёт ли та или иная функциональность в Rust 2021, является частью процесса RFC — поэтому список ожидаемых функций может и будет меняться. Это будет происходить до самого момента выпуска, но тем не менее, уже сейчас мы можем рассмотреть список функций, которые, скорее всего, в неё войдут.

### Изменения в прелюдии

В то время как типы и свободные функции могут быть добавлены в прелюдию без привязки к редакции, с трейтами всё иначе. Добавление трейта в прелюдию может вызвать проблемы совместимости — например, вызов метода с именем, совпадающим с именем метода нового трейта в области видимости, может привести к двусмысленности.

Сейчас в редакцию Rust 2021 предложено включить следующие трейты:

- `TryFrom`/`TryInto`
- `FromIterator`

RFC с этими изменениями можно найти [тут](https://github.com/rust-lang/rfcs/pull/3090). Обратите внимание, что RFC ещё не принят — состав новой прелюдии активно обсуждается.

### Новые правила захвата

[RFC 2229](https://github.com/rust-lang/rfcs/pull/2229) предлагает, когда это возможно, захватывать замыканиями отдельные поля, а не всю структуру целиком. Этот RFC уже принят. В некоторых случаях такое изменение может заставить деструкторы запускаться в другом месте, нежели сейчас, — из-за чего оно должно быть привязано к редакции. Миграция анализаторов должна свести к минимум изменения в семантике уже существующего кода.

### Новый распознаватель функциональности в Cargo по умолчанию

В Rust 1.51 будет стабилизирован новый [распознаватель функциональности](https://github.com/rust-lang/cargo/issues/8088) в Cargo, который разрешит зависимостям пакета использовать разную функциональность в разных контекстах. Например, пакет с `#[no_std]` сможет использовать одну и ту же зависимость и во время сборки (`build-dependencies` с включённым `std`), и как обычную зависимость (без `std`). Пока что это приводит к тому, что `std` будет включена в обоих случаях, так как функциональность находится в глобальном пространстве имён.

В Rust 2021 этот распознаватель будет включён по умолчанию, но его можно использовать и в старых версиях, просто выбрав вручную.

### Прочие изменения

Другие предложенные изменения включают [унификацию работы `panic` в `std` и `core`](https://github.com/rust-lang/rust/issues/80162) и обновление уровня некоторых проверок с [предупреждений до ошибок](https://github.com/rust-lang/rust/issues/80165).

Полный список обсуждаемых функций вы можете найти [здесь](https://docs.google.com/spreadsheets/d/1chZ2SL9T444nvU9al1kQ7TJMwC3IVQQV2xIv1HWGQ_k/edit?usp=sharing).

Если вы знаете о функциях, которых нет в этом списке, но они всё ещё обсуждаются для включения в Rust 2021, — [пожалуйста, дайте нам знать](https://rust-lang.zulipchat.com/#narrow/stream/268952-edition-2021). Несмотря на то, что мы всегда рады слышать о дополнительных функциях, которые ещё не планируются для включения в Rust, у нас, скорее всего, не будет возможности их обсудить, пока редакция Rust 2021 не будет готова.

## Примерный график

Итак, когда же мы планируем выпустить новую редакцию? Вот график основных этапов, к которому мы стремимся:

- 1 апреля — все релевантные редакции RFC или приняты, или в хорошем состоянии (т. е. все основные вопросы решены, и принятие RFC произойдёт в ближайшие недели).
- 1 мая — все нововведения, включённые в Rust 2021, находятся в Nightly с соответствующими feature-флагами.
- 1 июня — все проверки добавлены в Nightly.
- 1 сентября — редакция стабилизирована в Nightly.
- 21 октября — редакция полностью стабилизирована.

По мере приближения к этим срокам мы будем сужать список предлагаемых изменений до тех, что будут продвигаться активнее.

## Приглашаем к участию

Если вы хотите помочь в выпуске редакции Rust 2021 — пожалуйста, [свяжитесь с нами](https://rust-lang.zulipchat.com/#narrow/stream/268952-edition-2021). Помимо работы над функциональностью и планированием выпуска, у будет ещё очень много других важных дел. Вот только часть того, что необходимо для успешного выпуска:

- `rustfix` миграции для всех соответствующих функций,
- тестирование всех функций и путей их миграции,
- сообщения в блогах и другие маркетинговые материалы.
