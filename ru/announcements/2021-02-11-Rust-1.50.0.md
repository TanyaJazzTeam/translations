---
layout: post
title: Announcing Rust 1.50.0
author: The Rust Release Team
release: 'true'
---

Команда Rust рада сообщить о выпуске новой версии — 1.50.0. Rust — это язык программирования, позволяющий каждому создавать надёжное и эффективное программное обеспечение.

If you have a previous version of Rust installed via rustup, getting Rust 1.50.0 is as easy as:

```console
rustup update stable
```

If you don't have it already, you can [get `rustup`](https://www.rust-lang.org/install.html) from the appropriate page on our website, and check out the [detailed release notes for 1.50.0](https://github.com/rust-lang/rust/blob/master/RELEASES.md#version-1500-2021-02-11) on GitHub.

## What's in 1.50.0 stable

For this release, we have improved array indexing, expanded union field safety, refined file descriptors, and added to the standard library. See the [detailed release notes](https://github.com/rust-lang/rust/blob/master/RELEASES.md#version-1500-2021-02-11) to learn about other changes not covered by this post.

### Const-generic array indexing

Continuing the march toward stable `const` generics, this release adds implementations of `ops::Index` and `IndexMut` for arrays `[T; N]` for *any* length of `const N`. The indexing operator `[]` already worked on arrays through built-in compiler magic, but at the type level, arrays didn't actually implement the library traits until now.

```rust
fn second<C>(container: &C) -> &C::Output
where
    C: std::ops::Index<usize> + ?Sized,
{
    &container[1]
}

fn main() {
    let array: [i32; 3] = [1, 2, 3];
    assert_eq!(second(&array[..]), &2); // slices worked before
    assert_eq!(second(&array), &2); // now it also works directly
}
```

### Safe assignments to `ManuallyDrop<T>` union fields

В Rust 1.49 появилась возможность добавлять поля `ManuallyDrop<T>` в `union` как допустимый тип в реализации типажа `Drop` для объединений. Однако объединения не знают, какой вариант является действительным (они не уничтожают любое старое значение), так как в Rust для безопасности позволено использовать типы, которые реализуют типаж `Copy`, потому что у них никогда не вызывается `Drop`. Конечно, это верно и для `ManuallyDrop`, поэтому теперь Rust 1.50 позволяет безопасно назначать полям и его.

### A niche for `File` on Unix platforms

Некоторые типы в Rust имеют определённые ограничения на то, что считать допустимым значением, которое может не охватывать весь диапазон значений. Мы называем любое оставшееся недопустимое значение [нишей](https://rust-lang.github.io/unsafe-code-guidelines/glossary.html#niche), и это место может быть использовано для оптимизации схемы типа. Например, в Rust 1.28 мы представили `NonZero` типы, в которых `0` — ниша, и это позволило представлять `Option<NonZero>` со значением `0` как `None` без выделения лишней памяти.

На Unix-платформах `None` — это просто системный целочисленный файловый дескриптор. Это значит, что у нас есть возможная ниша — по той причине, что он никогда не может быть `-1`! Системные вызовы, которые возвращают файловый дескриптор, используют `-1` для обозначения того, что произошла ошибка (проверяем `errno`), так что `-1` никогда не будет действительным файловым дескриптором. Начиная с Rust 1.50 эта ниша добавлена в определение типа и тоже может быть использована для оптимизации схемы. И следовательно `Option<File>` теперь имеет такой же размер, как и `File`!

### Library changes

In Rust 1.50.0, there are nine new stable functions:

- [`bool::then`](https://doc.rust-lang.org/stable/std/primitive.bool.html#method.then)
- [`btree_map::Entry::or_insert_with_key`](https://doc.rust-lang.org/stable/std/collections/btree_map/enum.Entry.html#method.or_insert_with_key)
- [`f32::clamp`](https://doc.rust-lang.org/stable/std/primitive.f32.html#method.clamp)
- [`f64::clamp`](https://doc.rust-lang.org/stable/std/primitive.f64.html#method.clamp)
- [`hash_map::Entry::or_insert_with_key`](https://doc.rust-lang.org/stable/std/collections/hash_map/enum.Entry.html#method.or_insert_with_key)
- [`Ord::clamp`](https://doc.rust-lang.org/stable/std/cmp/trait.Ord.html#method.clamp)
- [`RefCell::take`](https://doc.rust-lang.org/stable/std/cell/struct.RefCell.html#method.take)
- [`slice::fill`](https://doc.rust-lang.org/stable/std/primitive.slice.html#method.fill)
- [`UnsafeCell::get_mut`](https://doc.rust-lang.org/stable/std/cell/struct.UnsafeCell.html#method.get_mut)

And quite a few existing functions were made `const`:

- [`IpAddr::is_ipv4`](https://doc.rust-lang.org/stable/std/net/enum.IpAddr.html#method.is_ipv4)
- [`IpAddr::is_ipv6`](https://doc.rust-lang.org/stable/std/net/enum.IpAddr.html#method.is_ipv6)
- [`Layout::size`](https://doc.rust-lang.org/stable/std/alloc/struct.Layout.html#method.size)
- [`Layout::align`](https://doc.rust-lang.org/stable/std/alloc/struct.Layout.html#method.align)
- [`Layout::from_size_align`](https://doc.rust-lang.org/stable/std/alloc/struct.Layout.html#method.from_size_align)
- `pow` for all integer types.
- `checked_pow` for all integer types.
- `saturating_pow` for all integer types.
- `wrapping_pow` for all integer types.
- `next_power_of_two` for all unsigned integer types.
- `checked_power_of_two` for all unsigned integer types.

See the [detailed release notes](https://github.com/rust-lang/rust/blob/master/RELEASES.md#version-1500-2021-02-11) to learn about other changes.

### Other changes

There are other changes in the Rust 1.50.0 release: check out what changed in [Rust](https://github.com/rust-lang/rust/blob/master/RELEASES.md#version-1500-2021-02-11), [Cargo](https://github.com/rust-lang/cargo/blob/master/CHANGELOG.md#cargo-150-2021-02-11), and [Clippy](https://github.com/rust-lang/rust-clippy/blob/master/CHANGELOG.md#rust-150).

## Contributors to 1.50.0

Many people came together to create Rust 1.50.0. We couldn't have done it without all of you. [Thanks!](https://thanks.rust-lang.org/rust/1.50.0/)
