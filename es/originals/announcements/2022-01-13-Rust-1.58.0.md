---
layout: correo
title: Anunciando Rust 1.58.0
author: El equipo de liberación de óxido
release: cierto
---

El equipo de Rust se complace en anunciar una nueva versión de Rust, 1.58.0. Rust es un lenguaje de programación que permite a todos crear software confiable y eficiente.

Si tiene una versión anterior de Rust instalada a través de rustup, obtener Rust 1.58.0 es tan fácil como:

```console
rustup update stable
```

Si aún no lo tiene, puede [obtener `rustup`] en la página correspondiente de nuestro sitio web y consultar las [notas detalladas de la versión 1.58.0] en GitHub.

## ¿Qué hay en 1.58.0 estable?

Rust 1.58 trae identificadores capturados en cadenas de formato, un cambio en la ruta de búsqueda de `Command` en Windows, más anotaciones `#[must_use]` en la biblioteca estándar y algunas estabilizaciones de biblioteca nuevas.

### Identificadores capturados en cadenas de formato

Las cadenas de formato ahora pueden capturar argumentos simplemente escribiendo `{ident}` en la cadena. Los formatos tienen argumentos posicionales aceptados desde hace mucho tiempo (opcionalmente por índice) y argumentos con nombre, por ejemplo:

```rust
println!("Hello, {}!", get_person());                // implicit position
println!("Hello, {0}!", get_person());               // explicit index
println!("Hello, {person}!", person = get_person()); // named
```

Ahora los argumentos con nombre también se pueden capturar desde el ámbito circundante, como:

```rust
let person = get_person();
// ...
println!("Hello, {person}!"); // captures the local `person`
```

Esto también se puede usar en los parámetros de formato:

```rust
let (width, precision) = get_format();
for (name, score) in get_scores() {
  println!("{name}: {score:width$.precision$}");
}
```

Las cadenas de formato solo pueden capturar identificadores simples, no rutas o expresiones arbitrarias. Para argumentos más complicados, asígnelos primero a un nombre local o use el estilo antiguo `name = expression` de argumentos de formato.

Esta función funciona en todas las macros que aceptan cadenas de formato. Sin embargo, un caso de esquina es el `panic!` macro en las ediciones de 2015 y 2018, donde `panic!("{ident}")` todavía se trata como una cadena sin formato; el compilador advertirá que esto no tiene el efecto deseado. Debido a la actualización de las macros de pánico de la edición 2021 para [mejorar la consistencia] , ¡esto funciona como se esperaba en 2021 `panic!` .

### Ruta de búsqueda `Command` Windows reducida

En destinos de Windows, `std::process::Command` ya no buscará archivos ejecutables en el directorio actual. Ese efecto se debió al comportamiento histórico de la API Win32 [`CreateProcess`] , por lo que Rust estaba buscando efectivamente en este orden:

1. (Específico de Rust) Los directorios que se enumeran en la variable de entorno `PATH` del elemento secundario, si se cambió explícitamente desde el elemento principal.
2. El directorio desde el que se cargó la aplicación.
3. El directorio actual para el proceso principal.
4. El directorio del sistema de Windows de 32 bits.
5. El directorio del sistema de Windows de 16 bits.
6. El directorio de Windows.
7. Los directorios que se enumeran en la variable de entorno `PATH` .

Sin embargo, usar el directorio actual puede generar resultados sorprendentes o incluso un comportamiento malicioso cuando se trata de directorios que no son de confianza. Por ejemplo, `ripgrep` publicó [CVE-2021-3013] cuando se enteraron de que sus procesos secundarios podrían interceptarse de esta manera. Incluso el propio PowerShell de Microsoft [documenta] que no usan el directorio actual por seguridad.

Rust ahora realiza su propia búsqueda sin el directorio actual, y el directorio heredado de 16 bits tampoco está incluido, ya que no hay una API para descubrir su ubicación. Entonces, el nuevo orden de búsqueda de `Command` para Rust en Windows es:

1. Los directorios que se enumeran en la variable de entorno `PATH` del elemento secundario.
2. El directorio desde el que se cargó la aplicación.
3. El directorio del sistema de Windows de 32 bits.
4. El directorio de Windows.
5. Los directorios que se enumeran en la variable de entorno `PATH` .

Los destinos que no son de Windows continúan usando su comportamiento específico de la plataforma, con mayor frecuencia solo considerando la variable de entorno `PATH` secundaria o principal.

### Más `#[must_use]` en la biblioteca estándar

El atributo `#[must_use]` se puede aplicar a tipos o funciones cuando no se los considera explícitamente o su resultado es casi seguro un error. Esto se ha utilizado durante mucho tiempo en la biblioteca estándar para tipos como `Result` , que debe verificarse en busca de condiciones de error. Esto también ayuda a detectar errores, como esperar que una función cambie un valor en el lugar, cuando en realidad devuelve un valor nuevo.

La [propuesta de biblioteca 35] se aprobó en octubre de 2021 para auditar y expandir la aplicación de `#[must_use]` en toda la biblioteca estándar, cubriendo muchas más funciones donde el efecto principal es el valor de retorno. Esto es similar a la idea de pureza de funciones, pero más flexible que una característica de lenguaje real. Algunas de estas adiciones estaban presentes en la versión 1.57.0, y ahora en 1.58.0 el esfuerzo se ha completado.

### API estabilizadas

Se estabilizaron los siguientes métodos e implementaciones de rasgos.

- [`Metadata::is_symlink`]
- [`Path::is_symlink`]
- [`{integer}::saturating_div`]
- [`Option::unwrap_unchecked`]
- [`Result::unwrap_unchecked`]
- [`Result::unwrap_err_unchecked`]
- [`NonZero{unsigned}::is_power_of_two`]

Las siguientes funciones previamente estables ahora son `const` .

- [`Duration::new`]
- [`Duration::checked_add`]
- [`Duration::saturating_add`]
- [`Duration::checked_sub`]
- [`Duration::saturating_sub`]
- [`Duration::checked_mul`]
- [`Duration::saturating_mul`]
- [`Duration::checked_div`]
- [`MaybeUninit::as_ptr`]
- [`MaybeUninit::as_mut_ptr`]
- [`MaybeUninit::assume_init`]
- [`MaybeUninit::assume_init_ref`]

### Otros cambios

Hay otros cambios en el lanzamiento de Rust 1.58.0: vea qué cambió en [Rust](https://github.com/rust-lang/rust/blob/master/RELEASES.md#version-1580-2022-01-13) , [Cargo](https://github.com/rust-lang/cargo/blob/master/CHANGELOG.md#cargo-158-2022-01-13) y [Clippy](https://github.com/rust-lang/rust-clippy/blob/master/CHANGELOG.md#rust-158) .

### Contribuyentes a 1.58.0

Mucha gente se unió para crear Rust 1.58.0. No podríamos haberlo hecho sin todos ustedes. [¡Gracias!](https://thanks.rust-lang.org/rust/1.58.0/)


[obtener `rustup`]: https://www.rust-lang.org/install.html
[notas detalladas de la versión 1.58.0]: https://github.com/rust-lang/rust/blob/master/RELEASES.md#version-1580-2022-01-13
[mejorar la consistencia]: https://doc.rust-lang.org/stable/edition-guide/rust-2021/panic-macro-consistency.html
[`CreateProcess`]: https://docs.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa
[CVE-2021-3013]: https://www.cve.org/CVERecord?id=CVE-2021-3013
[documenta]: https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_command_precedence?view=powershell-7.2
[propuesta de biblioteca 35]: https://github.com/rust-lang/libs-team/issues/35
[`Metadata::is_symlink`]: https://doc.rust-lang.org/stable/std/fs/struct.Metadata.html#method.is_symlink
[`Path::is_symlink`]: https://doc.rust-lang.org/stable/std/path/struct.Path.html#method.is_symlink
[`{integer}::saturating_div`]: https://doc.rust-lang.org/stable/std/primitive.i8.html#method.saturating_div
[`Option::unwrap_unchecked`]: https://doc.rust-lang.org/stable/std/option/enum.Option.html#method.unwrap_unchecked
[`Result::unwrap_unchecked`]: https://doc.rust-lang.org/stable/std/result/enum.Result.html#method.unwrap_unchecked
[`Result::unwrap_err_unchecked`]: https://doc.rust-lang.org/stable/std/result/enum.Result.html#method.unwrap_err_unchecked
[`NonZero{unsigned}::is_power_of_two`]: https://doc.rust-lang.org/stable/std/num/struct.NonZeroU8.html#method.is_power_of_two
[`Duration::new`]: https://doc.rust-lang.org/stable/std/time/struct.Duration.html#method.new
[`Duration::checked_add`]: https://doc.rust-lang.org/stable/std/time/struct.Duration.html#method.checked_add
[`Duration::saturating_add`]: https://doc.rust-lang.org/stable/std/time/struct.Duration.html#method.saturating_add
[`Duration::checked_sub`]: https://doc.rust-lang.org/stable/std/time/struct.Duration.html#method.checked_sub
[`Duration::saturating_sub`]: https://doc.rust-lang.org/stable/std/time/struct.Duration.html#method.saturating_sub
[`Duration::checked_mul`]: https://doc.rust-lang.org/stable/std/time/struct.Duration.html#method.checked_mul
[`Duration::saturating_mul`]: https://doc.rust-lang.org/stable/std/time/struct.Duration.html#method.saturating_mul
[`Duration::checked_div`]: https://doc.rust-lang.org/stable/std/time/struct.Duration.html#method.checked_div
[`MaybeUninit::as_ptr`]: https://doc.rust-lang.org/stable/std/mem/union.MaybeUninit.html#method.as_ptr
[`MaybeUninit::as_mut_ptr`]: https://doc.rust-lang.org/stable/std/mem/union.MaybeUninit.html#method.as_mut_ptr
[`MaybeUninit::assume_init`]: https://doc.rust-lang.org/stable/std/mem/union.MaybeUninit.html#method.assume_init
[`MaybeUninit::assume_init_ref`]: https://doc.rust-lang.org/stable/std/mem/union.MaybeUninit.html#method.assume_init_ref